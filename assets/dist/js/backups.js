function backupbuddy_saveLogAsFile(){var t=new Blob([jQuery("#backupbuddy_messages").text()],{type:"text/plain"}),e="backupbuddy-"+backupbuddy_serial+".txt",a=document.createElement("a");a.download=e,a.innerHTML="Download File",a.setAttribute("target","_new"),a.href=window.URL.createObjectURL(t),a.onclick=backupbuddy_destroyClickedElement,a.style.display="none",document.body.appendChild(a),a.click()}!function(t){var e=t("#backupbuddy_messages");function a(){keep_polling=0,statusBoxQueueEnabled=!1,t("#pb_backupbuddy_stop").hide(),t(".bb_progress-step-active").addClass("bb_progress-step-completed").removeClass("bb_progress-step-active"),t(".bb_progress-step-unfinished").addClass("bb_progress-step-completed"),t(".bb_progress-step-unfinished").addClass("bb_progress-step-finished"),t(".bb_progress-step-unfinished").removeClass("bb_progress-step-unfinished"),t(".backup-step-active").addClass("backup-step-finished").removeClass("backup-step-active"),t("#backup-function-backup_success").addClass("backup-step-finished"),t("#backup-function-deploy_success").addClass("backup-step-finished"),setTimeout((function(){t(".backup-step-active").removeClass("backup-step-active"),backupbuddy_log("Process Finished.","notice"),backupbuddy_ajax_call_stop()}),500)}function n(e){0!==keep_polling&&t("#backup-function-"+e).removeClass("backup-step-finished").addClass("backup-step-active")}function s(e){"deploy_runningImportBuddy"!=e&&t("#backup-function-"+e).removeClass("backup-step-active").addClass("backup-step-finished")}e.bind("backupbuddy_details backupbuddy_message backupbuddy_error backupbuddy_warning",(function(t,e){classType="","backupbuddy_error"==t.type&&(e.data=backupbuddyError(e.data),classType="error"),"backupbuddy_warning"==t.type&&(e.data=backupbuddyWarning(e.data),classType="warning"),backupbuddy_log(e,classType)})),e.bind("backupbuddy_milestone",(function(e,n){"finish_settings"==n.data||"start_database"==n.data||"finish_database"==n.data||"start_files"==n.data||"start_integrity"==n.data||"finish_integrity"==n.data||("finish_backup"==n.data?a():"finish_importbuddy"==n.data?(s("deploy_success"),t(".backup-step-active").removeClass("backup-step-active")):console.log("Solid Backups unspecified milestone: `"+n.data+"`."))})),e.bind("backupbuddy_startFunction",(function(e,a){try{functionInfo=t.parseJSON(a.data)}catch(e){console.log("Error parsing startFunction JSON:"+a.data)}var u=t(".bb_progress-bar"),d="bb_progress-step-active",c=t(".bb_progress-overview"),o="backup-step-active";t("."+d,u).addClass("bb_progress-step-completed").removeClass(d),t("."+o,c).addClass("backup-step-finished").removeClass(o),n(functionInfo.function),"pre_backup"==functionInfo.function&&t(".bb_progress-step-settings").length>0?t(".bb_progress-step-settings",u).addClass(d):"backup_create_database_dump"==functionInfo.function&&t(".bb_progress-step-database").length>0?(s("pre_backup"),t(".bb_progress-step-database",u).addClass(d)):"backup_zip_files"==functionInfo.function&&t(".bb_progress-step-files").length>0?(s("backup_create_database_dump"),t(".bb_progress-step-files",u).addClass(d)):"deploy_start"==functionInfo.function&&t(".bb_progress-step-deployTransfer").length>0?(t(".bb_progress-step-deployTransfer",u).addClass(d),n("backup_create_database_dump")):"deploy_push_start"==functionInfo.function?(t(".bb_progress-step-deployTransfer",u).addClass(d),n("deploy_sendContent")):"deploy_push_renderImportBuddy"==functionInfo.function&&t(".bb_progress-step-deployRestore").length>0?(s("deploy_sendContent"),t(".bb_progress-step-deployRestore",u).addClass(d)):"deploy_runningImportBuddy"==functionInfo.function?t("#backup-function-deploy_runningImportBuddy-secondary").slideDown():"deploy_pull_files"==functionInfo.function?(t(".bb_progress-step-deployTransfer",u).addClass(d),n("deploy_sendContent")):"deploy_pull_renderImportBuddy"==functionInfo.function&&(t(".bb_progress-step-deployRestore",u).addClass(d),s("deploy_sendContent"),n("deploy_runningImportBuddy")),html='<div class="backup-step backup-step-primary backup-function-'+functionInfo.function+'"><span class="backup-step-status backup-step-status-working"></span><span class="backup-step-title">'+functionInfo.title+"</span></div>",t(".backup-steps").append(html),""!==backupbuddy_currentFunction&&backupbuddy_log("Warning #237832a: A function `"+functionInfo.function+"` started before a prior function `"+backupbuddy_currentFunction+"` was completed."),backupbuddy_currentFunction=functionInfo.function})),e.bind("backupbuddy_finishFunction",(function(e,a){try{functionInfo=t.parseJSON(a.data)}catch(e){console.log("Error parsing finishFunction JSON:"+a.data)}"pre_backup"==functionInfo.function||("backup_create_database_dump"==functionInfo.function?last_sql_change=0:"backup_zip_files"==functionInfo.function&&(last_archive_change=0)),t(".backup-function-"+functionInfo.function).find(".backup-step-status-working").removeClass("backup-step-status-working").addClass("backup-step-status-finished"),functionInfo.function!==backupbuddy_currentFunction&&backupbuddy_log("Warning #237832b: A function `"+functionInfo.function+"` completed that does not match the function which was thought to be running `"+backupbuddy_currentFunction+"`."),backupbuddy_currentFunction=""})),e.bind("backupbuddy_startAction",(function(t,e){backupbuddy_log("Starting action: "+e.data),""!==backupbuddy_currentAction&&backupbuddy_log("Warning #3278374a: An action `"+e.data+"` started before a prior action `"+backupbuddy_currentAction+"` was completed."),backupbuddy_currentAction=e.data,backupbuddy_currentActionStart=unix_timestamp(),backupbuddy_currentActionLastWarn=0})),e.bind("backupbuddy_finishAction",(function(t,e){backupbuddy_log("Finishing action: "+e.data),""!==backupbuddy_currentAction&&e.data!==backupbuddy_currentAction&&backupbuddy_log("Warning #3278374b: An action `"+e.data+"` completed that does not match the action `"+backupbuddy_currentAction+"` which was thought to be running."),backupbuddy_currentAction="",backupbuddy_currentActionStart=0,backupbuddy_currentActionLastWarn=0})),e.bind("backupbuddy_deployFinished",(function(e,n){backupbuddy_log("Deployment finished (backupbuddy)."),setTimeout((function(){a(),t(".bb_actions_during").hide(),t(".bb_actions_after-deploy").show()}),5e3)})),e.bind("backupbuddy_undoDeployURL",(function(e,a){t(".pb_backupbuddy_deployUndo").attr("href",a.data).show()})),e.bind("backupbuddy_deployFilesRemaining",(function(e,a){t(".backupbuddy_sendContent_progress").text(a.data+" files remain.")})),e.bind("backupbuddy_deployFileSent",(function(e,a){sentObj=t("#backupbuddy_sendContent_sent"),count=parseInt(sentObj.attr("data-count"),10)+1,sentObj.attr("data-count",count),t(".backupbuddy_sendContent_sent").text(count+" transferred.")})),t("#backupbuddy_messages").bind("backupbuddy_loadImportBuddy",(function(e,a){try{importinfo=t.parseJSON(a.data)}catch(e){console.log("Error parsing loadImportBuddy JSON:"+a.data)}t("#backupbuddy_deploy_runningImportBuddy").attr("src",importinfo.url+"&display_mode=embed"),console.log("ImportStatusLog: "+importinfo.logurl),console.log(importinfo)})),e.bind("backupbuddy_errorFunction",(function(e,a){t(".backup-function-"+a.data).find(".backup-step-status-working").removeClass("backup-step-status-working").addClass("backup-step-status-error")})),e.bind("backupbuddy_startSubFunction",(function(e,a){try{functionInfo=t.parseJSON(a.data)}catch(e){console.log("Error parsing startSubFunction JSON:"+a.data)}void 0!==functionInfo.more?t("#backup-secondary-function-pre_backup").append('<div class="backup-step-title" title="'+functionInfo.function+'">'+functionInfo.title+' <a href="javascript:void(0)" class="backup-step-view-more">View List</a></div><div class="backup-step-title backup-step-secondary-hidden">'+functionInfo.more+"</div>"):t("#backup-secondary-function-pre_backup").append('<div class="backup-step-title" title="'+functionInfo.function+'">'+functionInfo.title+"</div>"),t("#backup-secondary-function-pre_backup").slideDown()})),e.bind("backupbuddy_archiveDeleted",(function(e,a){t("#pb_backupbuddy_archive_url").addClass("button-disabled"),t("#pb_backupbuddy_archive_url").attr("onClick","return false;"),t("#pb_backupbuddy_archive_send").addClass("button-disabled"),t("#pb_backupbuddy_archive_send").attr("onClick","var event = arguments[0] || window.event; event.stopPropagation(); return false;")})),e.bind("backupbuddy_ping",(function(t,e){backupbuddy_log(date+"&#x0009;0sec&#x0009;&#x0009;0mb&#x0009;Ping. Waiting for server . . .")})),e.bind("backupbuddy_error",(function(t,e){console.log("BACKUPBUDDY ERROR: "+e.data)})),e.bind("backupbuddy_warning",(function(e,a){html='<span class="backup-step-status backup-step-status-warning"></span><div class="backup-step backup-step-secondary"><span class="backup-step-title">'+a.data+"</span></div>",t(".backup-steps").append(html)})),e.bind("backupbuddy_archiveSize",(function(e,a){last_archive_size!=a.data&&(last_archive_size=a.data,"post_backup"==backupbuddy_currentFunction?last_archive_change=0:last_archive_change=unix_timestamp()),t(".backupbuddy_archive_size").text(a.data)})),e.bind("backupbuddy_startTableDump",(function(e,a){t("#backup-function-current-table").text("("+a.data+")")})),e.bind("backupbuddy_finishTableDump",(function(e,a){t("#backup-function-current-table").text("")})),e.bind("backupbuddy_sqlSize",(function(e,a){t.isNumeric(a.data)&&(last_sql_size!=a.data&&(last_sql_size=a.data,last_sql_change=unix_timestamp()),window.backupbuddy_currentDatabaseSize=parseInt(window.backupbuddy_currentDatabaseSize,10)+parseInt(a.data,10),totalPrettySize=backupbuddy_bytesToSize(window.backupbuddy_currentDatabaseSize),t(".backupbuddy_sql_size").text(totalPrettySize),backupbuddy_log("Total aggregate SQL dump size so far: "+totalPrettySize))})),e.bind("backupbuddy_sqlFile",(function(t,e){current_sql_file=e.data})),e.bind("backupbuddy_backupState",(function(e,a){try{stateInfo=t.parseJSON(a.data)}catch(e){console.log("Error parsing backupState JSON:"+a.data)}console.log("Solid Backups state (full logging mode only):"),console.dir(stateInfo)})),e.bind("backupbuddy_haltScript",(function(e,a){backupbuddy_ajax_call_stop(),statusBoxQueueEnabled=!1,0!==keep_polling&&(keep_polling=0,t(".bb_progress-step-active").removeClass("bb_progress-step-active"),t(".backup-step-active").addClass("backup-step-error").removeClass("backup-step-active"),t(".bb_progress-step-unfinished").addClass("bb_progress-step-completed"),t(".bb_progress-step-unfinished").addClass("bb_progress-step-error"),t(".bb_progress-step-unfinished").find(".bb_progress-step-title").text("Error!"),t(".bb_progress-step-unfinished").removeClass("bb_progress-step-unfinished"),t("#backup-function-backup_success").addClass("bb_progress-step-error"),t("#backup-function-backup_success .backup-step-title").text("Process Failed"),t(".bb_actions_during").hide(),t(".pb_actions_cancelled").show(),t(".backup-step-status-working").removeClass("backup-step-status-working").addClass("backup-step-status-error"),t("#pb_backupbuddy_stop").hide(),backupbuddy_log("***","notice"),""!==backupbuddy_currentFunction?backupbuddy_log("* Unfinished function: `"+backupbuddy_currentFunction+"`.","notice"):backupbuddy_log("* No in-progress function detected.","notice"),""!==backupbuddy_currentAction?backupbuddy_log("* Unfinished action: `"+backupbuddy_currentAction+"` ("+(unix_timestamp()-backupbuddy_currentActionStart)+" seconds ago).","notice"):backupbuddy_log("* No in-progress action detected.","notice"),backupbuddy_log("***","notice"),backupbuddy_showSuggestions(suggestions),errorHelp('Something went wrong creating the backup. See the Status Log tab above for details. <span class="description">Provide a copy of the Status Log if seeking support.</span>',suggestions),setTimeout((function(){backupbuddy_log("--- The backup has halted.")}),500))})),e.bind("backupbuddy_wait_init",(function(t,e){--backup_init_complete_poll_retry_count})),e.bind("backupbuddy_archiveInfo",(function(e,a){try{archiveInfo=t.parseJSON(a.data)}catch(e){console.log("Error parsing archiveInfo JSON:"+a.data)}t(".bb_actions_during").hide(),t(".bb_actions_after").show(),t("#pb_backupbuddy_archive_url").attr("href",archiveInfo.url),t("#pb_backupbuddy_archive_send").attr("rel",archiveInfo.file)})),t(".bb_overview").on("click",".backup-step-view-more",(function(e){e.preventDefault(),console.dir(t(this).closest("div")),t(this).closest("div").next(".backup-step-title").toggleClass("backup-step-secondary-hidden")}))}(jQuery);
